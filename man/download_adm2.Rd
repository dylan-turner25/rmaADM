% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helpers.R
\name{download_adm2}
\alias{download_adm2}
\title{Download and process USDA RMA Actuarial Data Master (ADM) files}
\usage{
download_adm2(
  years = 2012,
  adm_url = "https://pubfs-rma.fpac.usda.gov/pub/References/actuarial_data_master/",
  dir = "./data-raw",
  dataset_codes = c("A01090", "A00070"),
  keep_source_files = FALSE,
  overwrite = FALSE,
  compress = TRUE
)
}
\arguments{
\item{years}{Integer vector. The years of ADM data to download (e.g., \code{c(2012, 2013)}).}

\item{adm_url}{Character. Base URL for the ADM repository. Defaults to the public USDA RMA FTP URL.}

\item{dir}{Character. Local directory where files will be downloaded and processed. Created if it does not exist.}

\item{dataset_codes}{Character vector. File name patterns to retain, if null, keeps all files.}

\item{keep_source_files}{Logical. If \code{FALSE}, removes downloaded \code{.zip} archives after extraction.}

\item{overwrite}{Logical. If \code{TRUE}, re-downloads and re-processes files even if the existing data appears up to date.}

\item{compress}{Logical. If \code{TRUE}, applies data compression using \code{compress_adm()} function during processing. Defaults to \code{TRUE}.}
}
\value{
Invisibly returns \code{NULL}. Processed \code{.rds} files are written to disk in the specified directory.
}
\description{
Downloads ADM data files for the specified years from the USDA RMA actuarial data master repository,
extracts them, converts each \code{.txt} file to a memory-efficient \code{.rds} format using \code{data.table::fread()},
and processes the data in chunks to minimize RAM usage. Helper files can optionally be retained or filtered
based on matching codes. Source archives can also be deleted after extraction.
}
\details{
The function reads each \code{.txt} file in chunks (default 1 million rows at a time),
applies a \code{clean_data()} function to each chunk (assumed to be defined elsewhere),
and writes the results to compressed \code{.rds} files using \code{xz} compression.
Files are only re-downloaded if the remote data is newer than the latest local file,
unless \code{overwrite = TRUE}.
}
\note{
Files are read using \code{data.table::fread()} with all columns as character to reduce type inference overhead.
Chunked processing is used to reduce peak memory usage during conversion.
}
